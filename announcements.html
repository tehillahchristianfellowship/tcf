<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcements | TCF</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Image Style for Announcements */
        .announcement-img { 
            width: 100%; 
            height: 300px; 
            object-fit: cover; 
            display: block; 
            margin-bottom: 1rem;
            border-radius: 4px;
        }

        /* Embed Container Style - Improved for Responsiveness */
        .embed-container { 
            width: 100%; 
            position: relative;
            display: block;
            margin-bottom: 1rem;
            border-radius: 4px;
            overflow: hidden;
        }
        
        /* Force iframes inside to behave */
        .embed-container iframe { 
            width: 100%; 
            border: none; 
            /* Min height to ensure visibility if iframe doesn't set it */
            min-height: 300px; 
        }
        
        /* Hide extra links often included in embeds */
        .embed-container a { display: none; }

        @media (max-width: 768px) {
            .announcement-img { height: 200px; }
        }
    </style>
</head>
<body>

    <!-- NAV (Standard) -->
    <nav>
        <div class="logo-container">
            <a href="index.html"><img src="logo.png" alt="TCF Logo" class="logo-img"></a>
            <span class="church-name">TEHILLAH CHRISTIAN FELLOWSHIP</span>
        </div>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="about.html">About Us</a>
            <a href="gallery.html">Gallery</a>
            <a href="events.html">Events</a>
            <a href="give.html">Give</a>
            <a href="announcements.html" class="active">Announcements</a>
            <a href="contact.html" class="btn-visit">Contact Us</a>
        </div>
    </nav>

    <header class="hero hero-page">
        <h1 class="animate-fade">Announcements</h1>
        <p class="animate-fade delay-1">Stay up to date with what's happening at TCF.</p>
    </header>

    <!-- TAB FILTERS -->
    <div class="tabs-container">
        <div class="tabs-list" id="tabButtons">
            <button class="tab-btn active" data-filter="All">All News</button>
            <button class="tab-btn" data-filter="Church Wide">Church Wide</button>
            <button class="tab-btn" data-filter="Todah Max Mom">Todah Max Mom</button>
            <button class="tab-btn" data-filter="Barakong Tatay">Barakong Tatay</button>
            <button class="tab-btn" data-filter="Shabach / Halal">Shabach / Halal</button>
            <button class="tab-btn" data-filter="Yadah Cutie">Yadah Cutie</button>
            <button class="tab-btn" data-filter="Praise Team">Praise Team</button>
            <a href="multimedia.html" class="nav-tab-btn">Multimedia</a>
        </div>
    </div>

    <!-- CONTENT AREA -->
    <section class="container">
        <div id="loading" class="text-center" style="padding: 2rem; color: #666;">Loading announcements...</div>
        <div id="announcementsContainer"></div>
    </section>

    <!-- FOOTER -->
    <footer>
        <h3>Tehillah Christian Fellowship</h3>
        <p>Mc Arthur Street, Lopez Subdivision, Brgy 6, Victorias City</p>
        <p>&copy; 2026 TCF. All Rights Reserved.</p>
    </footer>

    <!-- DYNAMIC LOGIC -->
    <script type="module">
        // Import Firebase directly from CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Your Config
        const firebaseConfig = {
            apiKey: "AIzaSyBIXy1hHTjde62hjbLw3nwxMNSCY7HFGns",
            authDomain: "tehillah-website-9dd14.firebaseapp.com",
            projectId: "tehillah-website-9dd14",
            storageBucket: "tehillah-website-9dd14.firebasestorage.app",
            messagingSenderId: "40546309853",
            appId: "1:40546309853:web:4222b7887f6b86ec2e6d34",
            measurementId: "G-MSERH232QZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const container = document.getElementById('announcementsContainer');
        const loading = document.getElementById('loading');
        let allData = []; 

        // 1. Fetch Data on Load
        async function loadData() {
            try {
                const q = query(collection(db, "announcements"));
                const snapshot = await getDocs(q);
                
                allData = [];
                snapshot.forEach(doc => allData.push(doc.data()));
                
                // Sort in browser (Newest first)
                allData.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                
                loading.style.display = 'none';
                renderData("All"); // Show all by default
            } catch (error) {
                console.error(error);
                loading.innerHTML = `<span style="color:red">Error loading data: ${error.message}</span>`;
            }
        }

        // 2. Render Cards based on Filter
        function renderData(filter) {
            container.innerHTML = "";
            
            const filtered = filter === "All" 
                ? allData 
                : allData.filter(item => item.ministry === filter);

            if(filtered.length === 0) {
                container.innerHTML = `<p class="text-center" style="padding: 2rem;">No announcements found for ${filter}.</p>`;
                return;
            }

            filtered.forEach(item => {
                // --- SMART DISPLAY LOGIC ---
                let displayMedia = '';
                
                if (item.imageUrl && item.imageUrl.trim() !== "") {
                    let content = item.imageUrl.trim();
                    // Check if it starts with HTML tag like <div or <iframe
                    if (content.startsWith('<')) {
                        // Render as raw HTML (Embed)
                        displayMedia = `<div class="embed-container">${content}</div>`;
                    } else {
                        // Render as regular Image
                        displayMedia = `<img src="${content}" alt="${item.title}" class="announcement-img">`;
                    }
                }

                const card = `
                    <div class="announcement-card animate-fade">
                        ${displayMedia}
                        <span class="announcement-date">
                            ${item.dateStr} â€¢ <span style="color:var(--primary-gold)">${item.ministry}</span>
                        </span>
                        <h3>${item.title}</h3>
                        <p>${item.content}</p>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        // 3. Tab Click Logic
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                // Remove active class from all
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                // Add to clicked
                e.target.classList.add('active');
                // Render
                renderData(e.target.dataset.filter);
            });
        });

        loadData();
    </script>
</body>
</html>
