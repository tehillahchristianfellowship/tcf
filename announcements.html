<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcements | TCF</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* NEW: Image Style for Announcements */
        .announcement-img { 
            width: 100%; 
            height: 250px; 
            object-fit: cover; 
            display: block; 
            margin-bottom: 1rem;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <!-- NAV (Standard) -->
    <nav>
        <div class="logo-container">
            <a href="index.html"><img src="logo.png" alt="TCF Logo" class="logo-img"></a>
            <span class="church-name">TEHILLAH CHRISTIAN FELLOWSHIP</span>
        </div>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="about.html">About Us</a>
            <a href="ministries.html">Ministries</a>
            <a href="events.html">Events</a>
            <a href="give.html">Give</a>
            <a href="announcements.html" class="active">Announcements</a>
            <a href="contact.html" class="btn-visit">Contact Us</a>
        </div>
    </nav>

    <header class="hero hero-page">
        <h1 class="animate-fade">Announcements</h1>
        <p class="animate-fade delay-1">Stay up to date with what's happening at TCF.</p>
    </header>

    <!-- TAB FILTERS -->
    <div class="tabs-container">
        <div class="tabs-list" id="tabButtons">
            <button class="tab-btn active" data-filter="All">All News</button>
            <button class="tab-btn" data-filter="Church Wide">Church Wide</button>
            <button class="tab-btn" data-filter="Todah Max Mom">Todah Max Mom</button>
            <button class="tab-btn" data-filter="Barakong Tatay">Barakong Tatay</button>
            <button class="tab-btn" data-filter="Shabach / Halal">Shabach / Halal</button>
            <button class="tab-btn" data-filter="Yadah Cutie">Yadah Cutie</button>
            <button class="tab-btn" data-filter="Praise Team">Praise Team</button>
            <a href="multimedia.html" class="nav-tab-btn">Multimedia</a>
        </div>
    </div>

    <!-- CONTENT AREA -->
    <section class="container">
        <div id="loading" class="text-center" style="padding: 2rem; color: #666;">Loading announcements...</div>
        <div id="announcementsContainer"></div>
    </section>

    <!-- FOOTER -->
    <footer>
        <h3>Tehillah Christian Fellowship</h3>
        <p>Mc Arthur Street, Lopez Subdivision, Brgy 6, Victorias City</p>
        <p>&copy; 2026 TCF. All Rights Reserved.</p>
    </footer>

    <!-- DYNAMIC LOGIC -->
    <script type="module">
        import { db, collection, getDocs, query } from './firebase-config.js';

        const container = document.getElementById('announcementsContainer');
        const loading = document.getElementById('loading');
        let allData = []; // Store data here so we don't re-fetch on every click

        // 1. Fetch Data on Load
        async function loadData() {
            try {
                // Fetch announcements (no server sorting to prevent errors)
                const q = query(collection(db, "announcements"));
                const snapshot = await getDocs(q);
                
                allData = [];
                snapshot.forEach(doc => allData.push(doc.data()));
                
                // Sort in browser (Newest first)
                allData.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                
                loading.style.display = 'none';
                renderData("All"); // Show all by default
            } catch (error) {
                console.error(error);
                loading.innerHTML = `<span style="color:red">Error loading data: ${error.message}</span>`;
            }
        }

        // 2. Render Cards based on Filter
        function renderData(filter) {
            container.innerHTML = "";
            
            const filtered = filter === "All" 
                ? allData 
                : allData.filter(item => item.ministry === filter);

            if(filtered.length === 0) {
                container.innerHTML = `<p class="text-center" style="padding: 2rem;">No announcements found for ${filter}.</p>`;
                return;
            }

            filtered.forEach(item => {
                // NEW: Check if image URL exists
                const imageHTML = item.imageUrl ? `<img src="${item.imageUrl}" alt="${item.title}" class="announcement-img">` : '';

                const card = `
                    <div class="announcement-card animate-fade">
                        ${imageHTML}
                        <span class="announcement-date">
                            ${item.dateStr} â€¢ <span style="color:var(--primary-gold)">${item.ministry}</span>
                        </span>
                        <h3>${item.title}</h3>
                        <p>${item.content}</p>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        // 3. Tab Click Logic
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                // Remove active class from all
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                // Add to clicked
                e.target.classList.add('active');
                // Render
                renderData(e.target.dataset.filter);
            });
        });

        loadData();
    </script>
</body>
</html>
