<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events | TCF</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Re-adding needed event styles */
        .event-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: transform 0.3s; display: flex; flex-direction: column; }
        .event-card:hover { transform: translateY(-5px); }
        .event-header { background: var(--dark-bg); color: white; padding: 1.5rem; display: flex; align-items: center; gap: 15px; border-bottom: 4px solid var(--primary-gold); }
        .date-box { background: #333; border: 1px solid #555; padding: 10px; text-align: center; border-radius: 4px; min-width: 60px; }
        .date-month { display: block; font-size: 0.8rem; text-transform: uppercase; color: var(--primary-gold); }
        .date-day { display: block; font-size: 1.5rem; font-weight: bold; color: white; }
        .event-body { padding: 2rem; flex-grow: 1; }
        
        /* NEW: Image Style */
        .event-img { width: 100%; height: 200px; object-fit: cover; display: block; }
    </style>
</head>
<body>

    <nav>
        <div class="logo-container">
            <a href="index.html"><img src="logo.png" alt="TCF Logo" class="logo-img"></a>
            <span class="church-name">TEHILLAH CHRISTIAN FELLOWSHIP</span>
        </div>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="about.html">About Us</a>
            <a href="events.html" class="active">Events</a>
            <a href="give.html">Give</a>
            <a href="announcements.html">Announcements</a>
            <a href="contact.html" class="btn-visit">Contact Us</a>
        </div>
    </nav>

    <header class="hero hero-page">
        <h1 class="animate-fade">Upcoming Events</h1>
        <p class="animate-fade delay-1">Gather, Grow, and Go with us.</p>
    </header>

    <section class="container">
        <!-- Loading Message -->
        <div id="loading" class="text-center" style="padding: 2rem; color: #666;">Loading events...</div>
        
        <!-- Events Grid -->
        <div class="card-grid" id="eventsContainer">
            <!-- Dynamic events go here -->
        </div>
    </section>

    <footer>
        <h3>Tehillah Christian Fellowship</h3>
        <p>Mc Arthur Street, Lopez Subdivision, Brgy 6, Victorias City</p>
        <p>&copy; 2026 TCF. All Rights Reserved.</p>
    </footer>

    <!-- DYNAMIC LOGIC -->
    <script type="module">
        import { db, collection, getDocs, query } from './firebase-config.js';

        const container = document.getElementById('eventsContainer');
        const loading = document.getElementById('loading');

        async function loadEvents() {
            try {
                // Fetch events (without sorting on server to prevent errors)
                const q = query(collection(db, "events"));
                const snapshot = await getDocs(q);
                
                loading.style.display = 'none';
                
                if(snapshot.empty) {
                    container.innerHTML = `<p class="text-center" style="grid-column: 1/-1;">No upcoming events yet.</p>`;
                    return;
                }

                // Sort events in browser (Newest created first)
                let items = [];
                snapshot.forEach(doc => items.push(doc.data()));
                items.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));

                // Display events
                items.forEach(data => {
                    // NEW: Check if image URL exists
                    const imageHTML = data.imageUrl ? `<img src="${data.imageUrl}" alt="${data.title}" class="event-img">` : '';

                    const card = `
                        <div class="event-card animate-fade">
                            ${imageHTML}
                            <div class="event-header">
                                <div class="date-box">
                                    <span class="date-month">${data.month}</span>
                                    <span class="date-day">${data.day}</span>
                                </div>
                                <h3>${data.title}</h3>
                            </div>
                            <div class="event-body">
                                <span style="color:#888; font-weight:bold; font-size:0.9rem; display:block; margin-bottom:0.5rem;">
                                    ‚è∞ ${data.time}
                                </span>
                                <p style="color:#666; margin-bottom:1.5rem;">${data.desc}</p>
                                <a href="contact.html" style="color:var(--primary-gold); font-weight:bold; text-transform:uppercase; font-size:0.85rem;">
                                    Register / Info &rarr;
                                </a>
                            </div>
                        </div>
                    `;
                    container.innerHTML += card;
                });
            } catch (error) {
                console.error(error);
                loading.innerHTML = `<span style="color:red">Error loading events: ${error.message}</span>`;
            }
        }

        loadEvents();
    </script>
</body>
</html>

