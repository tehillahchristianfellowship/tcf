<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events | TCF</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Re-adding needed event styles */
        .event-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: transform 0.3s; display: flex; flex-direction: column; }
        .event-card:hover { transform: translateY(-5px); }
        .event-header { background: var(--dark-bg); color: white; padding: 1.5rem; display: flex; align-items: center; gap: 15px; border-bottom: 4px solid var(--primary-gold); }
        
        .date-box { background: #333; border: 1px solid #555; padding: 10px; text-align: center; border-radius: 4px; min-width: 60px; }
        .date-month { display: block; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: var(--primary-gold); }
        .date-day { display: block; font-size: 1.5rem; font-weight: bold; line-height: 1; }
        
        /* New Style for Recurring Events (No specific date) */
        .recur-box { background: var(--primary-gold); color: var(--dark-bg); padding: 5px 10px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; text-transform: uppercase; text-align: center; min-width: 60px; }

        .event-header h3 { font-size: 1.2rem; margin: 0; line-height: 1.3; }
        .event-img { width: 100%; height: 200px; object-fit: cover; display: block; }
        .event-body { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        
        /* Grid Layout */
        .events-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; padding: 2rem 10%; }
        .page-header { background: var(--dark-bg); color: white; padding: 5rem 10%; text-align: center; }
    </style>
</head>
<body>

    <!-- NAV -->
    <nav>
        <div class="logo-container">
            <a href="index.html"><img src="logo.png" alt="TCF Logo" class="logo-img"></a>
            <span class="church-name">TEHILLAH CHRISTIAN FELLOWSHIP</span>
        </div>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="about.html">About Us</a>
            <a href="events.html" class="active">Events</a>
            <a href="give.html">Give</a>
            <a href="announcements.html">Announcements</a>
            <a href="contact.html" class="btn-visit">Contact Us</a>
        </div>
    </nav>

    <!-- HEADER -->
    <header class="page-header">
        <h1 class="animate-fade">Upcoming Events</h1>
        <p class="animate-fade delay-1">Join us for fellowship, worship, and service.</p>
    </header>

    <!-- EVENTS GRID -->
    <section class="events-grid" id="eventsContainer">
        <p style="grid-column: 1/-1; text-align: center;">Loading events...</p>
    </section>

    <!-- FOOTER -->
    <footer>
        <h3>Tehillah Christian Fellowship</h3>
        <p>Mc Arthur Street, Lopez Subdivision, Brgy 6, Victorias City</p>
        <p>&copy; 2026 TCF. All Rights Reserved.</p>
    </footer>

    <!-- JAVASCRIPT -->
    <script type="module">
        import { db, collection, getDocs, query, orderBy } from './firebase-config.js';

        async function loadEvents() {
            const container = document.getElementById('eventsContainer');
            
            try {
                // If you have an index on 'createdAt', add orderBy('createdAt', 'desc')
                const q = query(collection(db, "events")); 
                const querySnapshot = await getDocs(q);
                
                container.innerHTML = ""; // Clear loading

                if (querySnapshot.empty) {
                    container.innerHTML = `<p style="grid-column: 1/-1; text-align: center;">No upcoming events at this time.</p>`;
                    return;
                }

                let items = [];
                querySnapshot.forEach(doc => items.push({ id: doc.id, ...doc.data() }));
                // Sort by creation manually if index missing
                items.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));

                items.forEach(data => {
                    // Logic to display Image if exists
                    const imageHTML = data.imageUrl ? `<img src="${data.imageUrl}" alt="${data.title}" class="event-img">` : '';

                    // Logic for Date Box vs Recurring Badge
                    let dateHTML = '';
                    if (data.month && data.day) {
                        // Standard Date
                        dateHTML = `
                            <div class="date-box">
                                <span class="date-month">${data.month}</span>
                                <span class="date-day">${data.day}</span>
                            </div>
                        `;
                    } else if (data.weekday) {
                        // Weekly Badge
                        dateHTML = `
                            <div class="recur-box">
                                ${data.weekday}
                            </div>
                        `;
                    } else {
                        // Fallback icon
                        dateHTML = `<div class="date-box" style="border:none; background:transparent; font-size:2rem;">üìÖ</div>`;
                    }

                    // Logic for Time String
                    let timeDisplay = "";
                    if (data.time) {
                        timeDisplay = data.time;
                    } else if (data.startTime && data.endTime) {
                        // Convert 24hr to 12hr roughly or just display
                        timeDisplay = `${convertTime(data.startTime)} - ${convertTime(data.endTime)}`;
                    } else {
                        timeDisplay = "See details";
                    }

                    const card = `
                        <div class="event-card animate-fade">
                            ${imageHTML}
                            <div class="event-header">
                                ${dateHTML}
                                <h3>${data.title}</h3>
                            </div>
                            <div class="event-body">
                                <span style="color:#888; font-weight:bold; font-size:0.9rem; display:block; margin-bottom:0.5rem;">
                                    ‚è∞ ${timeDisplay}
                                </span>
                                <p style="color:#666; margin-bottom:1.5rem;">${data.desc}</p>
                                <a href="contact.html" style="color:var(--primary-gold); font-weight:bold; text-transform:uppercase; font-size:0.85rem;">
                                    Register / Info &rarr;
                                </a>
                            </div>
                        </div>
                    `;
                    container.innerHTML += card;
                });
            } catch (error) {
                console.error(error);
                container.innerHTML = `<span style="color:red">Error loading events: ${error.message}</span>`;
            }
        }

        // Helper to make time look nicer (HH:MM 24hr -> 12hr)
        function convertTime(timeStr) {
            if(!timeStr) return "";
            let [hours, minutes] = timeStr.split(':');
            let ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            return `${hours}:${minutes} ${ampm}`;
        }

        loadEvents();
    </script>
</body>
</html>
