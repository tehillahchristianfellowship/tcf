<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TCF Admin Panel</title>
<link rel="stylesheet" href="style.css">

<style>
body { display:none; background:#f4f4f4; padding-bottom:4rem; }
.admin-nav {
    background:#111; color:#fff;
    padding:1rem 5%;
    display:flex; justify-content:space-between; align-items:center;
}
.logout-btn { background:none; border:1px solid #fff; color:#fff; padding:6px 14px; cursor:pointer; }

.admin-container { max-width:1000px; margin:2rem auto; padding:0 20px; }
.panel { background:#fff; padding:2rem; border-radius:8px; margin-bottom:2rem; }

.form-grid { display:grid; gap:1rem; }
.row { display:flex; gap:1rem; }
.col { flex:1; }

input, textarea, select {
    width:100%; padding:10px;
    border:1px solid #ddd; border-radius:4px;
}

.add-btn { background:#C5A059; color:#fff; border:none; padding:12px; font-weight:bold; cursor:pointer; }
.add-btn.secondary { background:#999; margin-top:6px; }

.item-list { border-top:1px solid #eee; margin-top:1rem; }
.list-item {
    display:flex; justify-content:space-between; align-items:center;
    padding:1rem 0; border-bottom:1px solid #eee;
}
.item-meta { font-size:0.85rem; color:#777; }

.action-btn { border:none; padding:6px 10px; cursor:pointer; border-radius:4px; }
.edit-btn { background:#3498db; color:#fff; }
.delete-btn { background:#e74c3c; color:#fff; margin-left:5px; }
</style>
</head>

<body>

<nav class="admin-nav">
    <h3>TCF Admin Panel</h3>
    <button id="logoutBtn" class="logout-btn">Log Out</button>
</nav>

<div class="admin-container">

<!-- ANNOUNCEMENTS -->
<div class="panel">
<h2>Announcement</h2>

<form id="announcementForm" class="form-grid">
<input type="text" id="annTitle" placeholder="Title" required>

<div class="row">
<div class="col">
<label>Date (Optional)</label>
<input type="date" id="annDate">
</div>
<div class="col">
<label>Schedule (Optional)</label>
<input type="text" id="annSchedule" placeholder="Everyday, 6:00 PM to 8:00 PM">
</div>
</div>

<select id="annMinistry">
<option>Church Wide</option>
<option>Todah Max Mom</option>
<option>Barakong Tatay</option>
<option>Shabach / Halal</option>
<option>Yadah Cutie</option>
<option>Praise Team</option>
<option>Multimedia</option>
</select>

<input type="url" id="annImageLink" placeholder="Image URL (optional)">
<textarea id="annContent" placeholder="Description" required></textarea>

<button class="add-btn" id="annSubmitBtn">Post Announcement</button>
<button type="button" class="add-btn secondary" id="annCancelBtn" style="display:none">Cancel Edit</button>
</form>

<div id="announcementList" class="item-list"></div>
</div>

<!-- EVENTS -->
<div class="panel">
<h2>Event</h2>

<form id="eventForm" class="form-grid">
<input type="text" id="evtTitle" placeholder="Event Name" required>

<div class="row">
<div class="col">
<label>Date (Optional)</label>
<input type="date" id="evtDate">
</div>
<div class="col">
<label>Schedule (Optional)</label>
<input type="text" id="evtSchedule" placeholder="Saturday, 4:00 PM to 7:00 PM">
</div>
</div>

<input type="url" id="evtImage" placeholder="Image URL (optional)">
<textarea id="evtDesc" placeholder="Event details" required></textarea>

<button class="add-btn" id="evtSubmitBtn">Add Event</button>
<button type="button" class="add-btn secondary" id="evtCancelBtn" style="display:none">Cancel Edit</button>
</form>

<div id="eventList" class="item-list"></div>
</div>

</div>

<script type="module">
import {
auth, db, signOut, onAuthStateChanged,
collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot
} from './firebase-config.js';

onAuthStateChanged(auth, user=>{
    if(user) document.body.style.display="block";
    else location.href="login.html";
});

logoutBtn.onclick=()=>signOut(auth);

let editingAnn=null;
let editingEvt=null;

function resetAnn(){
    announcementForm.reset();
    editingAnn=null;
    annSubmitBtn.innerText="Post Announcement";
    annCancelBtn.style.display="none";
}

function resetEvt(){
    eventForm.reset();
    editingEvt=null;
    evtSubmitBtn.innerText="Add Event";
    evtCancelBtn.style.display="none";
}

annCancelBtn.onclick=resetAnn;
evtCancelBtn.onclick=resetEvt;

announcementForm.onsubmit=async e=>{
e.preventDefault();
const data={
title:annTitle.value,
dateStr:annDate.value?new Date(annDate.value).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"",
schedule:annSchedule.value||"",
ministry:annMinistry.value,
content:annContent.value,
imageUrl:annImageLink.value||"",
createdAt:Date.now()
};
if(editingAnn)
await updateDoc(doc(db,"announcements",editingAnn),data);
else
await addDoc(collection(db,"announcements"),data);
resetAnn();
};

eventForm.onsubmit=async e=>{
e.preventDefault();
const d=evtDate.value?new Date(evtDate.value):null;
const data={
title:evtTitle.value,
month:d?d.toLocaleDateString("en-US",{month:"short"}).toUpperCase():"",
day:d?String(d.getDate()).padStart(2,"0"):"",
schedule:evtSchedule.value||"",
desc:evtDesc.value,
imageUrl:evtImage.value||"",
createdAt:Date.now()
};
if(editingEvt)
await updateDoc(doc(db,"events",editingEvt),data);
else
await addDoc(collection(db,"events"),data);
resetEvt();
};

onSnapshot(collection(db,"announcements"),snap=>{
announcementList.innerHTML="";
snap.forEach(s=>{
const d=s.data();
const div=document.createElement("div");
div.className="list-item";
div.innerHTML=`
<div>
<strong>${d.title}</strong>
<div class="item-meta">${d.ministry} ${d.schedule? "â€¢ "+d.schedule:""}</div>
</div>
<div>
<button class="action-btn edit-btn">Edit</button>
<button class="action-btn delete-btn">Delete</button>
</div>`;
div.querySelector(".edit-btn").onclick=()=>{
editingAnn=s.id;
annTitle.value=d.title;
annDate.value="";
annSchedule.value=d.schedule||"";
annMinistry.value=d.ministry;
annContent.value=d.content;
annImageLink.value=d.imageUrl||"";
annSubmitBtn.innerText="Update Announcement";
annCancelBtn.style.display="block";
};
div.querySelector(".delete-btn").onclick=()=>confirm("Delete?")&&deleteDoc(doc(db,"announcements",s.id));
announcementList.appendChild(div);
});
});

onSnapshot(collection(db,"events"),snap=>{
eventList.innerHTML="";
snap.forEach(s=>{
const d=s.data();
const div=document.createElement("div");
div.className="list-item";
div.innerHTML=`
<div>
<strong>${d.title}</strong>
<div class="item-meta">${d.schedule||""}</div>
</div>
<div>
<button class="action-btn edit-btn">Edit</button>
<button class="action-btn delete-btn">Delete</button>
</div>`;
div.querySelector(".edit-btn").onclick=()=>{
editingEvt=s.id;
evtTitle.value=d.title;
evtSchedule.value=d.schedule||"";
evtDesc.value=d.desc;
evtImage.value=d.imageUrl||"";
evtSubmitBtn.innerText="Update Event";
evtCancelBtn.style.display="block";
};
div.querySelector(".delete-btn").onclick=()=>confirm("Delete?")&&deleteDoc(doc(db,"events",s.id));
eventList.appendChild(div);
});
});
</script>

</body>
</html>
